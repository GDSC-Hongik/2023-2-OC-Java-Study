# 자바 병렬 프로그래밍 - 1장

초창기 컴퓨터 자체에는 운영체제가 존재하지 않았다. OS 없이 하드웨어 바로 위에서 실행되는 프로그램은 한 번에 하나의 프로그램밖에 실행할 수 없어 자원 대비 성능이 비효율적이었다. 따라서, 아래와 같은 요인으로 여러 프로그램을 실행할 수 있는 운영체제가 개발되었다.

- 자원 활용: 기다리는동안 다른 프로그램을 실행하도록!
- 공정성: 여러 사용자, 프로그램이 컴퓨터 내 자원에 대해 동일한 권한을 갖자.
- 편의성: 전부 처리하는 프로그램 하나 보다 나눠서 때에 맞는 프로그램을 쓰자!

이러한 동기를 바탕으로 한 프로세스 안에 여러개의 프로그램 제어 흐름이 공존하게 하기 위해 **스레드**가 등장했다.

---

## **스레드의 이점?**

**1. 멀티 프로세서 활용 가능**

스레드 별로 사용하는 프로세서의 처리 효율을 높일 수 있음

**2. 단순한 모델링**

한 스레드당 한가지 일을 할당함.

**3. 단순한 비동기 이벤트 처리**

클라이언트 프로그램에서 소켓 연결을 받는 서버 애플리케이션는 각 연결마다 스레드를 할당하고 동기 I/O를 사용하도록 하면 개발 작업이 쉬워짐.

**4. 더 빨리 반응하는 사용자 인터페이스**

GUI 어플리케이션은 단일 스레드로 동작했다. 이벤트 스레드에서 작업을 처리할때 별도 스레드에서 이를 실행한다면, 지속적으로 UI 이벤트를 처리할 수 있어 UI가 더 빨라졌을 것.

## **스레드 사용의 위험성**

자바에서의 스레드 기능이 내장된 점은 양날의 칼이다. 병렬 프로그램을 개발하는 일이 쉽긴하지만 여러 위험이 존재한다.

### **안전성 위해 요소**

스레드 안전성은 동기화를 충분히 해두지 않으면 결과를 예측하기 어렵다.임의의 수를 생성하는 아래 클래스가 있을때 스레드가 여러개라면 값을 예측하기가 어렵다.

`@NotThreadSafe
public class UnsafeSequence {
    private int value;
    public int getValue(){
        return value ++;
    }
}`

**@NotThreadSafe , @ThreadSafe**

비표준 어노테이션으로, 클래스를 사용하는 사람들에게 멀티스레드 환경에서의 문제여부를 명확히 알려주고, 개발자에게 스레드 안전성을 보장해야한다는 점을 주의할 수 있음.

이를 보호하기 위해선, 아래와 같이 수정할 수 있음.

`@ThreadSafe
public class UnsafeSequence {
    @GuardedBy("this")
    private int value;
    
    public synchronized int getValue(){
        return value ++;
    }
}`

**@GuardedBy: 해당 필드를 사용하기 위해선 지정된 락을 확보해야한다.**

**synchronized: 동기화를 시켜 data를 thread safe하게 만드는 것.**

### **활동성 위험**

안정성은 멀티스레드 뿐만 아니라, 단일스레드에서도 노력해야할 주제이다. 하지만, 단일 스레드에서 나타나지 않는 어떤 작업이 전혀 진전되지 않는 '활동성 문제'가 존재한다. (영영 기다리기..)

### **성능 위험**

스레드를 사용하면 실행 중에 어느정도 부하가 생기기도 한다. 컨텍스트 스위칭 등을 통해 성능에 부하가 생기기도 한다.

## **스레드는 어디에나?**

직접 코드로 스레드를 생성하지 않더라도, 프레임 워크에서 스레들르 생성할 수 있다. 자바 프로그램은 기본적으로 스레드를 사용하는데, JVM을 실행하면 메인 메소드를 생성할 주 스레드, 가비지 컬렉션이나 객체 종료와 같은 JVM 내부 작업을 담당할 스레드를 생성한다. 즉, 스레드는 개발자라면 필히 알아두어야할 지식이다.