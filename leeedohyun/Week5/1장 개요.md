# 작업을 동시에 실행하는 일에 대한 (아주) 간략한 역사
- 초창기에는 컴퓨터에는 운영체제가 없었기 때문에 한 번에 하나의 프로그램만 실행
- 운영체제는 여러 개의 프로그램을 각자의 프로세스 내에서 동시에 실행할 수 있도록 발전

그렇다면 운영체제가 여러 프로그램을 실행하도록 개발된 이유는 무엇일까?

- 자원 활용: 하나의 프로그램이 기다리는 동안 다른 프로그램을 실행하도록 지원하면서 효율적
- 공정성: 여러 사용자와 프로그램이 컴퓨터 내 자원에 대해 동일한 권한을 가질 수 있다.
- 편의성: 각기 일을 하나씩 처리하고 필요할 때 프로그램 간에 조율하는 프로그램을 여러 개 작성하는 것이 더 쉽고 바람직함

# 스레드의 이점
## 멀티 프로세서 활용
프로세스 스케줄링의 기본 단위는 스레드이기 때문에 스레드 하나로 동작하는 프로그램은 한 번에 최대 하나의 프로세서만 사용합니다. 여러 개의 스레드를 사용하면 프로세서가 하나라 해도 처리 속도를 높일 수 있습니다.

## 단순한 모델링
한 종류 일을 동시에 처리하는 프로그램은 작성하기 쉽고 오류도 별로 생기지 않습니다. 또 여러 종류의 일을 동시에 처리하는 프로그램보다 테스트하기도 쉽습니다. 복잡하면서 비동기적인 작업 흐름을 각기 별도 스레드에서 수행되는 더 단순하고 동기적인 작업 흐름 몇 개로 나눌 수 있다.

## 단순한 비동기 이벤트 처리
여러 클라이언트 프로그램에서 소켓 연결을 받는 서버 애플리케이션의 경우 각 연결마다 스레드를 할당하고 동기 I/O를 사용하도록 하면 개발 작업이 쉬워집니다. 

## 더 빨리 반응하는 사용자 인터페이스
GUI 애플리케이션은 보통 하나의 스레드에서 동작했습니다. 만약 상대적으로 오래 걸리는 작업을 실행하면 이벤트 스레드는 반응 속도가 느려집니다. 시간이 오래 걸리는 작업을 하는 경우에 별도의 스레드에서 실행했다면 이벤트 스레드는 계속 UI 이벤트를 처리할 수 있어 UI가 더 빨리 반응했을 것입니다.

# 스레드 사용의 위험성
## 안전성 위해 요소
동기화를 충분히 해두지 않으면 여러 스레드에서 실행되는 연산의 순서가 예측하기 어려운 경우가 있습니다. 

```java
@NotThreadSafe
public class UnsafeSequence {

    private int value;

    public int getNext() {
        return value++;
    }
}
```

위 클래스의 문제는 두 개의 스레드가 동시에 getNext 메서드를 호출 했을 때 발생합니다. 스레드 A가 getNext 메서드를 호출하고 value의 값을 증가시키기 전에 스레드 B가 getNext 메서드를 호출하면 초기의 value 값을 사용하게 됩니다. 즉, 두 스레드 간에 계산 결과는 같아질 가능성이 있습니다. 

위의 예제는 race condition을 보여주는 좋은 예제입니다. 여러 스레드가 같은 변수를 읽고 수정하게 하면 원래 순차적이던 프로그래밍 모델에 비순차적인 요소가 들어가 혼란스럽고 동작 과정을 추론하기 어려워질 수 있습니다. 그렇기 때문에 공유된 변수에 접근 시점을 조율해야 한다.

```java
@ThreadSafe
public class Sequence {
    
    @GuardedBy("this")
    private int value;

    public synchronized int getNext() {
        return value;
    }
}
```

이렇게 getNext를 동기화된 메서드로 만들면 문제는 해결됩니다. 

> @GuardedBy 어노테이션은 해당 필드나 메소드를 사용하려면 락을 보유해야만 접근할 수 있다는 것을 의미합니다.

## 활동성 위험
동시 수행 코드를 개발할 때는 반드시 스레드 안전성 문제를 신경써야 합니다. 단일 스레드 프로그램에서도 안전성과 정확성을 유지하도록 작성해야 하지만 멀티스레드를 사용하면 단일 스레드 프로그램에서 발생하지 않는 추가적인 안전성 위험에 노출 될 수 있고 활동성 장애가 생길 수 있습니다. 여기서 활동성의 의미는 `원하는 일이 결국 일어난다`는 보완적인 목표에 관한 것이다.

## 성능 위험
활동성이 뭔가 좋은 일이 반드시 일어난다는 것을 뜻하는 것이라면, 성능 문제는 형편없는 서비스 시간, 반응성, 처리율, 자원 소모, 규모에 따른 확장성 등 넓은 범위의 문제들을 포괄합니다.

# 스레드는 어디에나
모든 자바 프로그램은 기본적으로 스레드를 사용합니다. main 메서드를 실행할 주 스레드 뿐 아니라 가비지 컬렉션이나 객체 종료와 같은 JVM 내부 작업을 담당할 스레드도 생성하는 등 다양한 스레드를 생성합니다. 그렇기 때문에 스레드 안전성은 필수적입니다. 